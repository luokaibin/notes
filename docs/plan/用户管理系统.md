>所有字段均为小驼峰

# 流程设计

1. 浏览器打开页面，请求到后端，判断数据库连接状态，连接正常返回正常页面，连接异常返回安装页面，用户在安装页面配置好数据库信息，测试连接，连接异常提醒用户检查，连接正常，就判断表等信息，数据正确跳转到登录页面，数据不正确就初始化数据库或者补充对应数据表，完成之后跳转登录页面

``````mermaid
graph TD;
  A1(浏览器打开页面)-->A2(请求到达后端)-->A3(判断数据连接状态)-->A4(连接正常)-->A5(路径正确)-->A6(跳转到对应页面);
  A3T[连接状态是数据库连接上之后在程序里设置的一个值常量]-.->A3
		style A3T fill:#efefef,stroke:#ccc,stroke-width:1px
  A4-->B1(路径错误)-->B2(返回404页面)
  A3(判断数据连接状态)-->C1(连接异常)-->C2(给浏览器返<br>回安装页面)-->C3(用户输入超级管<br>理员和数据库信息)--提交-->C4(服务端检查数据<br>测试数据库连接)-->C5(数据错误)-->C6(页面提示用户)
  C4-->D1(数据正确)--"通知浏览器数据<br>通过,页面跳转到<br>初始化进度页面"-->D2{"页面loading,显示初始化进度<br>检查数据表: 检查结果<br>初始化数据表"}--初始化成功-->D4(跳转到登录页面)
  D1-->D3.1(服务端初始化数据库<br>初始化基础数据)--实时告诉浏览器进度-->D2
  D2---D3.2("初始化失败，暂停")
  C4-->E1(连接数据库)-->E2(获取数据表)-->E3("没有获取到表<br>空数据库")-->D3.1
  E2-->F1(获取到了表<br>数据表不为空)-->F2("1. 先遍历每一个表，是否有表存在数据的数据类型，字段名称")-->F3(q)
  F2-->F2.1(有表存在数据)-->"判断有数据的表的字段名称，数据类型是否"
  F2-->F2.2(所有表都没有数据)-->删除所有表-->D3.1
  %%RES2.1(有的数据表有数据)-->F4("遍历检查所有表的数据类型，字段名称")-->F4()"表中有数据,<br>字段、数据类型<br>符合我们要求"-->RES4.1(是我们定义的表)-->RES5(检查通过)--告诉浏览器初始化成功-->D3.1
  %%F4--表中有数据-->RES4.2(不是我们定义的表)--告诉浏览器<br>初始化失败-->D2
  %%F4--"遍历检查所有表的数据类型，字段名称"-->
  %%F2-->RES2.2(所有数据表都没数据)-->G1(删除所有表)-->D3.1
  %% 检查表结构<br>字段、数据类型
``````


















































# 数据库设计

## 用户表

| 字段       | 说明     | 类型   | 必填 | 其他说明                                      |
| ---------- | -------- | ------ | ---- | --------------------------------------------- |
| account    | 账号     | string | 是   | 系统生成                                      |
| password   | 密码     | string | 否   | 通过算法加密存储                              |
| portrait   | 头像     | string | 否   | base64，url 都可以，base64 string长度需要放长 |
| nickName   | 昵称     | string | 否   | 昵称需要有长度限制，最长128个汉字             |
| platformId | 平台     | string | 是   | 用户和平台强绑定                              |
| roleId     | 角色id   | string | 否   | 用户的角色                                    |
| createAt   | 创建时间 | string | 否   | 账号创建时间，系统自动生成                    |
| updateAt   | 更新时间 | string | 否   | 数据更新时间，系统自动生成                    |

## 平台表

| 字段 | 说明     | 类型   | 必填 | 其他说明 |
| ---- | -------- | ------ | ---- | -------- |
| ID   | 平台ID   | string | 是   | 系统生成 |
| code | 平台code | string | 是   | 用户输入 |
| name | 平台名字 | string | 是   |          |
| logo | 平台logo | string | 否   |          |

## 用户绑定信息表

| 字段        | 说明           | 类型   | 必填 | 其他说明                                                 |
| ----------- | -------------- | ------ | ---- | -------------------------------------------------------- |
| account     | 用户账户       | string | 是   |                                                          |
| platformId  | 平台           | string | 是   |                                                          |
| type        | 绑定类型code   | string | 是   |                                                          |
| typeAccount | 绑定类型的账号 | string | 是   | 如果绑定的是手机，这个就是手机号，如果是邮箱，就是邮箱号 |
| other       | 其他信息       | string | 否   | 其他信息                                                 |

## 绑定类型的字典表

| 字段 | 说明     | 类型   | 必填 | 其他说明       |
| ---- | -------- | ------ | ---- | -------------- |
| id   | 类型ID   | string | 是   |                |
| code | 类型code | string | 是   | 没有code就是ID |
| name | 类型名字 | string | 是   |                |
| icon | 类型icon | string | 否   | 图片           |

## 操作表

| 字段       | 说明         | 类型   | 必填 | 其他说明             |
| ---------- | ------------ | ------ | ---- | -------------------- |
| id         | id           | string | 是   |                      |
| name       | 操作名       | string | 是   |                      |
| code       | 操作code     | string | 是   |                      |
| platformId | 操作所属平台 | string | 否   | 系统的操作不可增删改 |

## 模块表

| 字段       | 说明     | 类型   | 必填 | 其他说明 |
| ---------- | -------- | ------ | ---- | -------- |
| id         | 模块ID   | string | 是   |          |
| name       | 模块名字 | string | 是   |          |
| platformId | 所属平台 | string | 是   |          |
| operateId  | 操作id   | string | 是   |          |

## 角色表

> 角色是权限的集合

| 字段       | 说明         | 类型   | 必填 | 其他说明 |
| ---------- | ------------ | ------ | ---- | -------- |
| id         | 角色id       | string | 是   | id唯一   |
| name       | 角色名称     | string | 是   |          |
| icon       | icon         | string | 否   |          |
| platformId | 角色所属平台 | string | 否   |          |
| code       | 角色code     | string | 是   |          |

## 角色操作关联表

| 字段      | 说明   | 类型   | 必填 | 其他说明 |
| --------- | ------ | ------ | ---- | -------- |
| roleID    | 角色id | string | 是   |          |
| operateId | 操作id | string | 是   |          |

## 用户登录信息记录

> 本期不做

| 字段       | 说明     | 类型   | 必填 | 其他说明 |
| ---------- | -------- | ------ | ---- | -------- |
| account    | 用户账户 | string | 是   |          |
| platformId | 平台     | string | 是   |          |
| device     | 登录设备 | string | 否   |          |
| region     | 登录地区 | string | 否   |          |
| loginTime  | 登录时间 | string | 否   |          |
| createAt   | 记录时间 | string | 否   |          |

# 接口设计

超级管理员一个，已配置文件形式保存超级管理员信息

## 接口

### 平台注册接口

作用1: 用户与平台绑定，没有绑定平台的用户禁止登录

作用2: 给管理员分配权限，管理员可以绑定多个平台，按平台分配权限

### 普通用户注册接口，

用户注册时需要传入 **平台ID** 没有平台ID，校验平台是否存在，平台不存在不给注册；

注册时需要传入管理员信息，校验管理员是否存在，校验管理员是否有这个平台的管理权限，不存在不给注册，做这个限制是为了溯源，用户是通过那个管理员注册的

### 普通用户登录

密码，验证码，快捷方式

校验平台，是否可以在这个平台登录

记录登录IP，登录设备，做常用地常用设备校验，异地等情况需要二次验证

### 添加管理员

仅超级管理员有权限

管理员需要绑定平台

管理员需要设置身份，**运营者和管理者**

运营者只有查看权限，管理者可以修改删除

权限都仅在绑定的平台有效

管理员可以添加运营者，指定运营者的平台，仅管理员管理的平台

### 获取管理员列表

### 获取用户列表

传入当前登录者信息

支持根据平台过滤，支持搜索、注册时间范围、上次登录时间、地区查询，

返回上次登录时间，上次登录设备，上次登录地区

### 添加用户

